---
id: 1
title: update-phase-4-constitution
stage: constitution
date: 2026-02-08
surface: agent
model: Claude Sonnet 4.5
feature: none
branch: 003-ai-agents-layer
user: pc
command: sp.constitution
labels: [constitution, phase-4, infrastructure, deployment]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
 - .specify/memory/constitution.md
 - .specify/templates/spec-template.md
 - .specify/templates/plan-template.md
 - .specify/templates/tasks-template.md
tests:
---
## Prompt

```
Title: Spec-Driven Local Kubernetes Deployment Constitution
Phase: IV (Infrastructure & Deployment)
Base Phase: Phase III (Todo AI Chatbot)

1. Constitutional Scope

Phase-4 is a strict superset of Phase-3.

All application logic, APIs, agents, MCP servers, and UI behavior from Phase-3 must remain unchanged.

Phase-4 introduces only infrastructure, deployment, and operational layers.

No feature development, refactoring, or logic changes are allowed in Phase-4.

Invariant Rule:

If something works in Phase-3, Phase-4 must deploy it as-is.

2. Folder & Code Hierarchy Law

The Phase-4/ folder is an exact copy of Phase-3/ at initialization.

All new work must be added around the existing codebase, not inside it unless explicitly required for containerization.

Allowed new directories:

/docker
/helm
/k8s
/infra
/scripts


Frontend and backend source folders must not be reorganized.

Protected Assets:

/frontend

/backend

/specs

Existing .env.example files

3. Spec-Driven Development Law

Phase-4 must follow this order without exception:

sp.specify ‚Üí sp.plan ‚Üí sp.tasks ‚Üí Claude Code execution


Rules:

No implementation before spec approval

No Dockerfiles, YAMLs, or Helm charts without a spec

Claude Code is the only executor

Human writes zero infrastructure code manually

4. Infrastructure-Only Mandate

Phase-4 concerns only:

Docker containerization

Kubernetes deployment (Minikube)

Helm chart packaging

AI-assisted DevOps tooling

Explicitly forbidden:

Changing API routes

Modifying database schema

Editing agent logic

Altering authentication flow

Optimizing business logic

5. Containerization Constitution (Docker + Gordon)

Frontend and backend must be containerized separately.

Docker AI Agent (Gordon) must be used when available.

If Gordon is unavailable:

Standard Docker CLI commands may be generated by Claude Code.

Docker images must:

Be development-friendly

Expose required ports only

Accept configuration via environment variables

No multi-stage optimization required ‚Äî clarity > performance.

6. Kubernetes Deployment Law (Minikube)

Deployment target is local Minikube only.

Kubernetes resources must include:

Deployments

Services

ConfigMaps

Secrets

No cloud-specific resources are allowed.

Resource limits should be reasonable but not over-engineered.

Stateless Guarantee:
Kubernetes pods must remain stateless; persistence stays in the database layer as defined in Phase-3.

7. Helm Chart Governance

Helm charts are mandatory for deployment.

Charts must:

Be configurable via values.yaml

Support replica scaling

Separate frontend and backend concerns

Helm charts must reflect the existing Phase-3 architecture exactly.

Helm is a packaging layer, not a redesign tool.

8. AI-Assisted DevOps Law
kubectl-ai

Used for:

Deployment

Scaling

Debugging

Status inspection

Kagent

Used for:

Cluster health analysis

Resource optimization suggestions

Learning-oriented diagnostics

AI tools assist operations ‚Äî they do not replace specs.

9. Environment & Secrets Law

Environment variables from Phase-3 must remain valid.

Secrets (OpenAI API key, auth secrets) must:

Never be hardcoded

Be injected via Kubernetes Secrets

Local development assumptions are allowed.

.env.example must remain the source of truth.

10. Validation & Success Criteria

Phase-4 is considered successful only if:

Minikube cluster runs successfully

Frontend is reachable via Kubernetes Service

Backend API responds correctly

Chatbot functionality works end-to-end

Pods survive restarts without data loss

kubectl-ai and kagent can inspect the cluster

11. Agent Authority & Responsibility

Each agent operates only within its assigned domain:

Agent    Authority
Infra Spec Agent    Infrastructure definition
Dockerization Agent    Container design
Helm Architect Agent    Helm structure
K8s Ops Agent    Deployment & scaling
Cluster Intel Agent    Health & optimization
Env & Secrets Agent    Configuration safety
Deployment Validation Agent    Verification
Agentic Orchestrator    Workflow enforcement

No agent may:

Skip steps

Override specs

Impleme
```

## Response snapshot

Updated the project constitution to reflect Phase-4 requirements for infrastructure and deployment. The changes include:

1. Updated constitution version from 1.0.0 to 2.0.0 to reflect major changes
2. Changed focus from Phase-3 (AI chatbot) to Phase-4 (infrastructure/deployment)
3. Added new principles specific to infrastructure requirements:
   - Infrastructure-Only Mandate
   - Containerization Constitution
   - Kubernetes Deployment Law
   - Helm Chart Governance
   - AI-Assisted DevOps Law
   - Environment & Secrets Law
   - Validation & Success Criteria
   - Agent Authority & Responsibility

4. Updated templates to align with Phase-4 requirements:
   - spec-template.md: Added infrastructure-specific functional requirements
   - plan-template.md: Updated constitution checks to focus on infrastructure preservation
   - tasks-template.md: Updated to reflect Docker, Kubernetes, and Helm tasks

5. Maintained preservation of all Phase-3 functionality as required by the constitution

## Outcome

- ‚úÖ Impact: High - Major constitution update to support Phase-4 infrastructure requirements
- üß™ Tests: No specific tests needed for constitution update
- üìÅ Files: Updated constitution and 3 templates to align with new requirements
- üîÅ Next prompts: Will be based on Phase-4 spec, plan, and tasks generation
- üß† Reflection: Successfully transformed constitution to support infrastructure focus while maintaining all previous functionality

## Evaluation notes (flywheel)

- Failure modes observed: None
- Graders run and results (PASS/FAIL): N/A
- Prompt variant (if applicable): N/A
- Next experiment (smallest change to try): Begin Phase-4 spec generation based on updated constitution